<!DOCTYPE html><html lang="en"><head><!-- set page info --><title>Functional Counter in HTML</title><meta name="title" content="Functional Counter in HTML"><meta name="description" content="A technical exposition of creating a functional prize counter ticker in HTML using JavaScript."><!-- data --><meta charset="UTF-8"><!-- jQuery --><!-- fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital@0;1&family=Open+Sans:ital,wght@0,300;0,500;1,400;1,500&family=Orbitron:wght@500&display=swap" rel="stylesheet"><!-- <link rel="preload" href="LibreBaskerville-Italic.ttf" as="font" type="font/ttf" crossorigin /> --><style>main>:is(h2,h3,h4){margin-left:.25rem}.date{text-align:right;margin-right:1rem}
:root{--accent: rgb(74, 128, 199);--accent-dark: rgb(38, 60, 131);--black: rgb(15, 18, 25);--blue-dark: rgb(26 30 43);--off-white: rgb(214, 214, 214);--white: rgb(237, 237, 237);--gray: rgb(99, 99, 99);--slate-dark: rgb(36, 41, 46);--page-Wmax: 1100px}html{height:100%}body{margin:0;padding:0;background:var(--blue-dark);background-attachment:fixed;color:var(--white);line-height:1.5;font-size:18px;font-family:Open Sans}*{box-sizing:border-box}main{max-width:var(--page-Wmax);margin:2rem auto;padding:0 1rem}*::-webkit-scrollbar{width:.5rem}*::-webkit-scrollbar-thumb{background-color:var(--accent);border-radius:.2rem;border-top:1px solid var(--accent-dark);border-bottom:1px solid var(--accent-dark)}*::-webkit-scrollbar-track{background-color:color-mix(in srgb,var(--gray),transparent)}h1,h2,h3,h4,h5,h6{margin:0;padding:0;color:color-mix(in srgb,var(--accent) 50%,white)}h1{text-align:center;margin:1rem 0;font-size:2.5rem}h2{margin-top:3rem}h3{margin-top:2rem}hr{border-color:color-mix(in srgb,var(--accent),transparent 70%);margin:3rem 2rem 2rem}ol>::marker,ul>::marker{color:color-mix(in srgb,var(--accent) 50%,white)}pre{padding:1rem .5rem;margin:0 1rem;background:var(--slate-dark)}:not(pre)>code{background:var(--slate-dark);padding:.2rem .3rem;color:color-mix(in srgb,var(--accent),white)}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}header[data-astro-cid-3ef6ksr2]{max-width:var(--page-Wmax);margin:0 auto;border-bottom:1px solid}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;padding:.5em 1.25rem .5rem .5rem;font-size:2rem}.site-title[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{font-family:Libre Baskerville;font-style:italic;color:var(--off-white);text-decoration:none;font-weight:100}.site-links[data-astro-cid-3ef6ksr2]{flex-grow:1;display:flex;justify-content:center}.social-links[data-astro-cid-3ef6ksr2]{display:flex;gap:.5em;justify-self:flex-end}.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:inline-block;height:3rem}.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]:hover{filter:drop-shadow(0 0 .25em var(--accent));transition:filter .15s}.social-links[data-astro-cid-3ef6ksr2] img[data-astro-cid-3ef6ksr2]{height:100%}footer[data-astro-cid-sz7xmlte]{display:flex;width:100%;justify-content:center;padding:1rem;font-size:.8rem}
</style><script type="module" src="/_astro/hoisted.d027dff3.js"></script></head><body><header data-astro-cid-3ef6ksr2><nav data-astro-cid-3ef6ksr2><h3 class="site-title" data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Unexpected Dreams</a></h3><div class="site-links" data-astro-cid-3ef6ksr2><!-- <a href="/about">About</a> --></div><div class="social-links" data-astro-cid-3ef6ksr2><a href="https://ko-fi.com/unexpected_dreams" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Follow Unexpected Dreams on Ko-fi</span><img src="/assets/kofi_icon.png" data-astro-cid-3ef6ksr2></a><a href="https://unexpected-dreams.itch.io/" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Follow Unexpected Dreams on itch.io</span><img src="/assets/itchio_icon.png" data-astro-cid-3ef6ksr2></a><a href="https://www.reddit.com/r/Unexpected_Works/" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Follow Unexpected Dreams on Reddit</span><img src="/assets/reddit_icon.png" data-astro-cid-3ef6ksr2></a></div></nav></header><main><h1>Functional Counter in HTML</h1><div class="date">Monday, Oct 23, 2023</div><iframe type="text/html" src="/counter.html" style="width: 100%; height: 12rem; border: none; margin: 2rem 0 1rem 0;"></iframe>
<h2 id="1-setup">1. Setup</h2>
<p>Try out the counter at the top. Neat right? It’s inspired by a video that a friend sent me about recreating the prize counter from Squid Game in HTML. The original however simply used a preset number so I took it upon myself to make a REAL functional counter.</p>
<p>This isn’t meant to be a comprehensive CSS / JS tutorial, just an exposition of my thought process — so I’ll be skipping details like how to generate elements &#x26; how to display and style them. The psuedocode examples are in quasi-jquery.</p>
<p>Some vocabulary out of the way first:</p>
<ul>
<li>prize — the human readable value we see in the counter
<ul>
<li>old — start value</li>
<li>new — end value</li>
</ul>
</li>
<li>delta — the change between the old prize value and the new prize value</li>
<li>digit — a number character, 0-9</li>
<li>place — the position of the digit, ie. ones tens hundreds, thousands
<ul>
<li><code>p0</code>— variable, stores the ones place digit of the prize, <code>10^0</code></li>
<li><code>p1</code>— variable, stores the tens place digit of the prize, <code>10^1</code></li>
<li>etc</li>
</ul>
</li>
<li>roller — the wheel that spins while the numbers are adjusting</li>
<li>tick  — one individual digit displayed on the roller</li>
<li><code>count</code> — variable, stores the number of ticks a digit has to pass through to get to the new digit value</li>
</ul>
<p>Now to start, let’s make a list of the behavior we need to create:</p>
<ul>
<li>Display the digit in each place for the old prize</li>
<li>Create &#x26; spin a roller for each place, from the old prize digit to the new prize digit</li>
<li>Spin the rollers on the right faster than the ones on the left</li>
<li>Make the roller be reusable</li>
</ul>
<hr>
<h2 id="2-digits">2. Digits</h2>
<p>First order of business, parsing out the digits in each place — eg. <code>135642</code> into:</p>
<ul>
<li><code>1</code> in the hundred thousands</li>
<li><code>3</code> in the ten thousands</li>
<li><code>5</code> in the thousand</li>
<li><code>2</code> in the hundreds</li>
<li><code>4</code> in the tens</li>
<li><code>6</code> in the ones</li>
</ul>
<p>The rigorously CORRECT way to do this is to perform math with a modulus operator:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> prize   </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 135642</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> p0</span><span style="color:#F97583">    =</span><span style="color:#E1E4E8"> (prize </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> p1</span><span style="color:#F97583">    =</span><span style="color:#E1E4E8"> (prize </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 100</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> p0) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> p2</span><span style="color:#F97583">    =</span><span style="color:#E1E4E8"> (prize </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 1000</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> p0 </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> (p1 </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> p3</span><span style="color:#F97583">    =</span><span style="color:#E1E4E8"> (prize </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10000</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> p0 </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> (p1 </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> (p2 </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">    // etc</span></span></code></pre>
<p>While this is good and dandy &#x26; can be simplified to use a loop, there is however a MUCH lazier method — which is of course what I used. The prize values are all positive whole numbers, so you can just convert them to a string and grab the nth character.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> prize   </span><span style="color:#F97583">=</span><span style="color:#B392F0"> String</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">135642</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> p2</span><span style="color:#F97583">    =</span><span style="color:#E1E4E8"> prize[(prize.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> p5</span><span style="color:#F97583">    =</span><span style="color:#E1E4E8"> prize[(prize.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">];</span></span>
<span class="line"><span style="color:#6A737D">    // etc</span></span></code></pre>
<p>Now that we have the digits of each place, we can place them in containers side by side.</p>
<hr>
<h2 id="3-rollers">3. Rollers</h2>
<p>I thought of three different ways to implement a counter:</p>
<ol>
<li>generate one tick for each digit 0-9 and reuse it as needed</li>
<li>dynamically generate ticks one by one for each tick a place goes through</li>
<li>dynamically generate all the ticks for a place at once</li>
</ol>
<p>Each method has its pros and cons, though I found #3 to be easiest for recreating a spinning illusion. #1 can be less complicated — eg. if we were creating an abacus. Since we intend to spin the right side faster though we’d need to calculate how fast the animation is playing, when we need to move the digits the up the top to bottom, and probably the animation timing function itself as well. We’d also need to be mindful of spacing between them to make it seem like a cohesive wheel, ie. that they don’t overlap. That doesn’t sound particularly fun.</p>
<p>#2 also has this same issue, but benefits from not needing the track the position of each digit since we’re tracking instead the change from the original digit. Since we’re generating the ticks as we need them, we don’t have to track end state and can just dump them when finishd — could be useful for emulating a calender flip. However, for our wheel, handling multiple animations to speed up and slow down together would be a nightmare.</p>
<p>The method I used, #3 also has curious issues which I’ll get into later as we continue, but overall I found generating a column of numbers like an unraveled wheel and sliding through them to be the most straightforward.</p>
<p>As for cases to consider, there are two main ones: incrementing and decrementing. A sharp reader might say, “But what about looping over zero, surely that’s another case for each no?” Well, I’ll get back to you on that. Let’s break down the problem again and start with something simple.</p>
<h3 id="31-incrementing">3.1 Incrementing</h3>
<p>For <code>135642 -> 135667</code> (example 1), this is what we want to create:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">    1</span><span style="color:#79B8FF"> 3</span><span style="color:#79B8FF"> 5</span><span style="color:#79B8FF"> 6</span><span style="color:#79B8FF"> 4</span><span style="color:#79B8FF"> 2</span><span style="color:#6A737D">  // old prize value</span></span>
<span class="line"><span style="color:#79B8FF">            5</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#79B8FF">            6</span><span style="color:#79B8FF"> 4</span></span>
<span class="line"><span style="color:#79B8FF">              5</span></span>
<span class="line"><span style="color:#79B8FF">              6</span></span>
<span class="line"><span style="color:#79B8FF">              7</span></span>
<span class="line"><span style="color:#6A737D">//  1 3 5 6 6 7  new prize value</span></span></code></pre>
<p>Take a look at the ones place and have some psuedocode:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">    // create roller element</span></span>
<span class="line"><span style="color:#F97583">    new</span><span style="color:#E1E4E8"> $roller;</span></span>
<span class="line"><span style="color:#6A737D">    // # ticks = (new prize digit, 7) - (old prize digit, 2)</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> count</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 7</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> count) {</span></span>
<span class="line"><span style="color:#6A737D">        // create tick element</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#E1E4E8"> $tick;</span></span>
<span class="line"><span style="color:#6A737D">        // tick digit = start digit + change</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick.digit </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> i;</span></span>
<span class="line"><span style="color:#6A737D">        // tick position = height * i</span></span>
<span class="line"><span style="color:#6A737D">        // add to roller</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">css</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'top'</span><span style="color:#E1E4E8">, $tick.height </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> i)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">($roller);</span></span>
<span class="line"><span style="color:#6A737D">        // increment change</span></span>
<span class="line"><span style="color:#E1E4E8">        i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<p>What I’ve done is create a relative positioned container to represent each roller and populated it with absolute positioned ticks, using its <code>i</code> value to calculate distance from the top. We can also use <code>count</code> to calculate the total distance we need to translate the container. We’ve got a basic counter now.</p>
<p>Ah, but what of zero? Take a look at what happens in the ones place when you go from <code>135642 -> 135671</code> (example 2):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">    1</span><span style="color:#79B8FF"> 3</span><span style="color:#79B8FF"> 5</span><span style="color:#79B8FF"> 6</span><span style="color:#79B8FF"> 4</span><span style="color:#79B8FF"> 2</span><span style="color:#6A737D">  // old prize value</span></span>
<span class="line"><span style="color:#79B8FF">            5</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#79B8FF">            6</span><span style="color:#79B8FF"> 4</span></span>
<span class="line"><span style="color:#79B8FF">            7</span><span style="color:#79B8FF"> 5</span></span>
<span class="line"><span style="color:#79B8FF">              6</span></span>
<span class="line"><span style="color:#79B8FF">              7</span></span>
<span class="line"><span style="color:#79B8FF">              8</span></span>
<span class="line"><span style="color:#79B8FF">              9</span></span>
<span class="line"><span style="color:#79B8FF">              0</span></span>
<span class="line"><span style="color:#79B8FF">              1</span></span>
<span class="line"><span style="color:#6A737D">//  5 5 5 7 7 1  new prize value</span></span></code></pre>
<p>If we handle this in the exact same way as example 1, <code>count</code> will be negative. We can’t simply flip the sign and call it a day — a curious quirk of math: numbers are mirrored over zero — the digits would be wrong.</p>
<p>If we think about the behavior we’re supposed to be emulating, it isn’t going from <code>2 -> 1</code> but rather <code>2 -> 11</code>, so we can solve the issue by shifting the new prize digit by 10.</p>
<p>In fact, we don’t even need to check if the new prize digit is greater or less than the old prize digit since the distance between the digits is ALWAYS less than 10. We can simply shift the new prize digit by 10 regardless, then perform a modulus to get the sub 10 remainder. We do the same for the tick value because all we care about is that last digit in the ones place.</p>
<p>More psuedocode:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    new</span><span style="color:#E1E4E8"> $roller;</span></span>
<span class="line"><span style="color:#6A737D">    // # ticks = (10 + (new prize digit, 1) - (old prize digit, 2)) % 10</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> count</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> count) {</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#E1E4E8"> $tick;</span></span>
<span class="line"><span style="color:#6A737D">        // tick digit = start digit + change</span></span>
<span class="line"><span style="color:#6A737D">        // ditch everything but ones place digit</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick.digit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> i) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">css</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'top'</span><span style="color:#E1E4E8">, $tick.height </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> i)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">($roller);</span></span>
<span class="line"><span style="color:#E1E4E8">        i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<p>We’ve now got a setup for incrementing from any prize value to any other prize value. Nothing happens for a roller when a place’s digit is the same for both the new and old prize values since <code>count</code> is zero but that’s fine for now. We’ll call this the <code>zero count</code> problem and come back to it later.</p>
<h3 id="32-decrementing">3.2 Decrementing</h3>
<p>Let’s look at <code>135642 -> 000007</code> (example 3). We’ll generate a roller that going <em><strong>UP</strong></em> now instead since the wheel is supposed to spin in the other direction:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">//  0 0 0 0 0 7  new prize value</span></span>
<span class="line"><span style="color:#79B8FF">          0</span></span>
<span class="line"><span style="color:#79B8FF">        0</span><span style="color:#79B8FF"> 1</span><span style="color:#79B8FF">   7</span></span>
<span class="line"><span style="color:#79B8FF">        1</span><span style="color:#79B8FF"> 2</span><span style="color:#79B8FF"> 0</span><span style="color:#79B8FF"> 8</span></span>
<span class="line"><span style="color:#79B8FF">      0</span><span style="color:#79B8FF"> 2</span><span style="color:#79B8FF"> 3</span><span style="color:#79B8FF"> 1</span><span style="color:#79B8FF"> 9</span></span>
<span class="line"><span style="color:#79B8FF">      1</span><span style="color:#79B8FF"> 3</span><span style="color:#79B8FF"> 4</span><span style="color:#79B8FF"> 2</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#79B8FF">    0</span><span style="color:#79B8FF"> 2</span><span style="color:#79B8FF"> 4</span><span style="color:#79B8FF"> 5</span><span style="color:#79B8FF"> 3</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#79B8FF">    1</span><span style="color:#79B8FF"> 3</span><span style="color:#79B8FF"> 5</span><span style="color:#79B8FF"> 6</span><span style="color:#79B8FF"> 4</span><span style="color:#79B8FF"> 2</span><span style="color:#6A737D">  // old prize value</span></span></code></pre>
<p>Notice how we need to get the digits for places greater than the new prize value — another benefit of working with strings since we can simply <code>.padStart</code> with zeros.</p>
<p>The logic is mostly unchanged, though we need to swap the direction of the calculation for <code>count</code> since we’re moving backwards. We also need to add a safety to prevent the tick digit from becoming negative since we’re subtracting now. The solution is the same as before and for the same reason — shifting by 10 and modulus.</p>
<p>Actually, we intend to add extra spins later which means we’ll need to pad this number even more. Let’s use… one billion, there that should do it. Psuedocode:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    new</span><span style="color:#E1E4E8"> $roller;</span></span>
<span class="line"><span style="color:#6A737D">    // # ticks = (10 + (old prize digit, 2) - (new prize digit, 7)) % 10</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> count</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 7</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> count) {</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#E1E4E8"> $tick;</span></span>
<span class="line"><span style="color:#6A737D">        // tick digit = start digit - change</span></span>
<span class="line"><span style="color:#6A737D">        // + pad to prevent it from going negative</span></span>
<span class="line"><span style="color:#6A737D">        // dump everything but ones place digit</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick.digit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1000000000</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> i) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">css</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'top'</span><span style="color:#E1E4E8">, $tick.height </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">i)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">($roller);</span></span>
<span class="line"><span style="color:#E1E4E8">        i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">9</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<p>Since all we care is the last digit, this padding doesn’t interfere with the incrementing case either. We can lump both incrementing and decrementing together by tracking sign via <code>1</code> or <code>-1</code> and multiplying where appropriate:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    new</span><span style="color:#E1E4E8"> $roller;</span></span>
<span class="line"><span style="color:#6A737D">    // # ticks = (10 + ((new prize digit, 7) - (old prize digit, 2)) * (sign, -1)) % 10</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> count</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">7</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> count) {</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#E1E4E8"> $tick;</span></span>
<span class="line"><span style="color:#6A737D">        // tick digit = start digit + change * (sign, -1)</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick.digit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1000000000</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">        // tick position = height * i * (sign, -1)</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">css</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'top'</span><span style="color:#E1E4E8">, $tick.height </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">($roller);</span></span>
<span class="line"><span style="color:#E1E4E8">        i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<hr>
<h2 id="4-spin-speed-emulation">4. Spin Speed Emulation</h2>
<p>The part I’m sure you’ve all been waiting for: emulating a real counter by spinning the right side faster than the left (but actually they’re sliding, shhh).</p>
<p>We might tackle this by tracking the largest place that changes and giving extra spins to subsequently smaller places — but if you look at <code>1000 -> 999</code> that means the hundreds get one extra spin, the tens two extra spins, and the ones three. That’s not behavior we want.</p>
<p>What’s important now is not what the old or new prize values are but the DELTA between them, ie. <code>100 -> 101</code> should spin at the same speed as <code>10000 -> 10001</code>. For a 1 digit delta, no extra spins are handed out. For a 3 digit delta the tens should get one extra spin and the ones should get two.</p>
<p>(For fun, I tried what would happen if we calculated the ACTUAL spin as though the counter were a real physical object, ie. <code>0 -> 100</code> means the ones place cycles through one hundred ticks. My browser didn’t like that very much — especially when I input half a million.)</p>
<h3 id="41-extra-spins">4.1 Extra Spins</h3>
<p>Anyway, <code>100000 -> 99599</code> (example 4) should look like this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">//  0 9 9 5 9 9  new prize value</span></span>
<span class="line"><span style="color:#79B8FF">              9</span></span>
<span class="line"><span style="color:#79B8FF">              0</span></span>
<span class="line"><span style="color:#79B8FF">              1</span></span>
<span class="line"><span style="color:#79B8FF">              2</span></span>
<span class="line"><span style="color:#79B8FF">              3</span></span>
<span class="line"><span style="color:#79B8FF">              4</span></span>
<span class="line"><span style="color:#79B8FF">              5</span></span>
<span class="line"><span style="color:#79B8FF">              6</span></span>
<span class="line"><span style="color:#79B8FF">              7</span></span>
<span class="line"><span style="color:#79B8FF">              8</span></span>
<span class="line"><span style="color:#79B8FF">            9</span><span style="color:#79B8FF"> 9</span></span>
<span class="line"><span style="color:#79B8FF">            0</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#79B8FF">            1</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#79B8FF">            2</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#79B8FF">            3</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#79B8FF">            4</span><span style="color:#79B8FF"> 4</span></span>
<span class="line"><span style="color:#79B8FF">          5</span><span style="color:#79B8FF"> 5</span><span style="color:#79B8FF"> 5</span></span>
<span class="line"><span style="color:#79B8FF">          6</span><span style="color:#79B8FF"> 6</span><span style="color:#79B8FF"> 6</span></span>
<span class="line"><span style="color:#79B8FF">          7</span><span style="color:#79B8FF"> 7</span><span style="color:#79B8FF"> 7</span></span>
<span class="line"><span style="color:#79B8FF">          8</span><span style="color:#79B8FF"> 8</span><span style="color:#79B8FF"> 8</span></span>
<span class="line"><span style="color:#79B8FF">    0</span><span style="color:#79B8FF"> 9</span><span style="color:#79B8FF"> 9</span><span style="color:#79B8FF"> 9</span><span style="color:#79B8FF"> 9</span><span style="color:#79B8FF"> 9</span></span>
<span class="line"><span style="color:#79B8FF">    1</span><span style="color:#79B8FF"> 0</span><span style="color:#79B8FF"> 0</span><span style="color:#79B8FF"> 0</span><span style="color:#79B8FF"> 0</span><span style="color:#79B8FF"> 0</span><span style="color:#6A737D">  // old prize value</span></span></code></pre>
<p>So we simply subtract the two to get delta and — based off the size of delta — we know which places get extra spins. Notice that the hundred thousands place, ten thousands places, and thousands places change but we don’t get extra spins until the tens place. This is what we want since delta is only 401, so those numbers should be slow.</p>
<p>This implementation ALSO solve the <code>zero count</code> problem because:</p>
<ol>
<li>The largest place in delta is always non-zero</li>
<li>which means the largest place’s digit always changes since we’re adding or subtracting a non-zero digit</li>
<li>which means any place where the the old and new prize digits are the same will always be a place smaller than the largest</li>
<li>which means these places will always get at least one extra spin <small style="padding:0 2rem;">(cue ominous music)</small></li>
</ol>
<p>Psuedocode:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    new</span><span style="color:#E1E4E8"> $roller;</span></span>
<span class="line"><span style="color:#6A737D">    // calculate extra spins by distance between this place and delta's max place, minimum zero</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> place_delta</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(delta).</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> spin_extra</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">max</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, (place_delta </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> place_this));</span></span>
<span class="line"><span style="color:#6A737D">    // # ticks = </span></span>
<span class="line"><span style="color:#6A737D">    //    ((10 + ((new prize digit, 9) - (old prize digit, 0)) * (sign, -1)) % 10)</span></span>
<span class="line"><span style="color:#6A737D">    //    + (10 * extra_spins)</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> count</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ((</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">9</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> spin_extra);</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> count) {</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#E1E4E8"> $tick;</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick.digit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1000000000</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">css</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'top'</span><span style="color:#E1E4E8">, $tick.height </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">($roller);</span></span>
<span class="line"><span style="color:#E1E4E8">        i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<p>Simple… right? But take a look at this, <code>3000 -> 2099</code> (example 5):</p>
<iframe type="text/html" src="/counter-broken.html" style="width: 100%; height: 12rem; border: none; margin: 2rem 0 1rem 0;"></iframe>
<h3 id="42-short-delta--eleven-funky">4.2 Short Delta / Eleven Funky</h3>
<p>What just happened? What we have USUALLY works, but there’s an error in the assumptions we made above (#2). Let me introduce the <code>short delta</code> problem, though I like to call it the <code>Eleven Funky</code>. Both names are made up by me, but if there’s a real name for the issue let me know. Here’s what’s happening:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">//  11    carryover, the funky 11 in action</span></span>
<span class="line"><span style="color:#79B8FF">    2090</span></span>
<span class="line"><span style="color:#F97583">  +</span><span style="color:#79B8FF">  910</span></span>
<span class="line"><span style="color:#E1E4E8">  ______</span></span>
<span class="line"><span style="color:#79B8FF">    3000</span></span></code></pre>
<p>In a nutshell: even though we’re adding or subtracting a non-zero digit, that digit can remain unchanged if we have carryover.</p>
<p>We could do fancy math to calculate for carryover, but I just added an extra check to see if the current place matched the largest place in delta and if <code>count</code> was still zero after the initial calculation. This isn’t a perfect solution since the tens and hundreds place in <code>3000 -> 2099</code> get almost the same spin (10 vs 11 ticks), but it isn’t really noticeable.</p>
<p>Psuedocode:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">    new</span><span style="color:#E1E4E8"> $roller;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> place_delta</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">abs</span><span style="color:#E1E4E8">(delta).</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> spin_extra</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">max</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, (place_delta </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> place_this));</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> count </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ((</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">0</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">10</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> spin_extra);</span></span>
<span class="line"><span style="color:#6A737D">    // if still zero and this place is the max delta place, then make it spin at least once</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ((count </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> (place_delta </span><span style="color:#F97583">===</span><span style="color:#E1E4E8"> place_this)) {</span></span>
<span class="line"><span style="color:#E1E4E8">        count </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> count) {</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#E1E4E8"> $tick;</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick.digit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1000000000</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        $tick</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">css</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'top'</span><span style="color:#E1E4E8">, $tick.height </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">*</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            .</span><span style="color:#B392F0">appendTo</span><span style="color:#E1E4E8">($roller);</span></span>
<span class="line"><span style="color:#E1E4E8">        i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span></code></pre>
<hr>
<h2 id="5-reusability-and-cleanup">5. Reusability and Cleanup</h2>
<p>I hide all these extra ticks by giving the container that holds the rollers <code>overflow: hidden;</code>. The counter is made reusable by generating a second invisible roller behind the one that’s translating and give it the start position with the new prize value. This second roller replaces the original when the animation finishes.</p>
<p>And there we have it, a functional counter that emulates a spinner ticker. I added a couple small details like increasing the animation length based off the size of delta, giving the duration a tiny bit of random adjust, and adding a delay to the larger places. Curious, I think writing this up took more time than actually making the counter.</p></main><footer data-astro-cid-sz7xmlte>
&copy; 2023 Unexpected Dreams. All rights reserved.
</footer></body></html>